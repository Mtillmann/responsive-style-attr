!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).RespStyleAttr={})}(this,(function(e){"use strict";var t={debug:!0,breakpointSelector:"html",breakpointKey:"default",selectorTemplate:function(e){return".rsa-"+e},selectorPropertyAttacher:function(e,t){return e.classList.add("rsa-"+t)},attachStyleNodeTo:"head",scopedStyleNode:!0,breakpoints:null,ignoreDOM:!1,alwaysPrependMediatype:!0};function s(e,s){void 0===s&&(s="info"),t.debug&&console[s]("ResponsiveStyleAttributes DEBUG:",e)}var i=function(){function e(e){void 0===e&&(e={}),this.breakpoints=[],this.breakpointMap={},this.keyMap=[],this.regexps={},this.options=e,this.selector=this.options.breakpointSelector,this.key=this.options.breakpointKey,this.getBreakpoints()}return e.prototype.index=function(e){return this.keyMap.indexOf(e)},e.prototype.next=function(e){return this.breakpoints[this.index(e)+1]},e.prototype.value=function(e){return this.breakpointMap[e]||null},e.prototype.test=function(e){return this.regexps.test.test(e)},e.prototype.processKey=function(e,t){var s=this.regexps.isOnly.test(t),i=this.regexps.isUp.test(t),r=this.regexps.isDown.test(t),o=this.regexps.isBetween.test(t),n=this.regexps.usesOnlyBreakpointKeys.exec(t),a=this.regexps.usesMixedValues.exec(t),p=null,h=null;if(a)a[1]&&a[2]?(h=this.value(a[1]),p=a[2]):a[3]&&a[4]&&(h=a[3],p=this.value(a[4]));else if(n){var d=n[1],l=n[2];if(h=this.value(d),s){var u=this.next(d);u&&(p=u[1])}else r?(p=h,h=null):o&&(p=this.value(l))}else{var c=this.regexps.actualBreakpoints.exec(t);c&&(o?(h=c[1],p=c[2]):r?p=c[3]:h=i?c[3]:c[0])}h&&(e["min-width"]=h),p&&(e["max-width"]=p)},e.prototype.getBreakpoints=function(){var e,t=this,i="--breakpoints-"+this.key,r=[];if(this.options.breakpoints)this.breakpoints=this.options.breakpoints;else{if(!(e=getComputedStyle(document.querySelector(this.selector)||document.documentElement).getPropertyValue(i)))return void s('No JSON breakpoint definition found for "'+this.selector+" { "+i+': ... ; }"',"error");try{this.breakpoints=JSON.parse(e)}catch(t){return s('JSON.parse failed for breakpoint definition of "'+this.selector+" { "+i+': ... ; }": '+t.message,"error"),void s('JSON given "'+e+'"',"error")}this.breakpoints instanceof Array||(s('JSON parse of given breakpoints did not yield expected array in format [["key", "value"], ...]'),this.breakpoints=[["undefined","0px"]])}this.breakpoints.forEach((function(e){t.keyMap.push(e[0]),t.breakpointMap[e[0]]=e[1],r.push(e[0])}));var o=r.join("|"),n=o+"|\\d+\\w{2,3}";return this.regexps={test:new RegExp("^("+n+")(?:-(?:to|up|down)-?)?("+n+")?$"),isOnly:new RegExp("^("+o+")?$"),isUp:new RegExp("^("+n+")-up?$"),isDown:new RegExp("^("+n+")-down?$"),isBetween:new RegExp("^("+n+")-to-("+n+")?$"),actualBreakpoints:new RegExp("^(?:(\\d+\\w{2,3})-to-(\\d+\\w{2,3})|(\\d+\\w{2,3})(?:-\\w{2,4})?)$"),usesOnlyBreakpointKeys:new RegExp("^("+o+")(?:-(?:to|up|down)-?)?("+o+")?$"),usesMixedValues:new RegExp("^(?:("+o+")-to-(\\d+\\w{2,3})|(\\d+\\w{2,3})-to-("+o+"))$")},this.breakpoints},e}(),r={},o=function(e,t){void 0===t&&(t=0);for(var s=3735928559^t,i=1103547991^t,r=0,o=void 0;r<e.length;r++)o=e.charCodeAt(r),s=Math.imul(s^o,2654435761),i=Math.imul(i^o,1597334677);return s=Math.imul(s^s>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&(i=Math.imul(i^i>>>16,2246822507)^Math.imul(s^s>>>13,3266489909)))+(s>>>0)},n=function(){function e(e){void 0===e&&(e={}),this.mediaQueries={},this.styles={},this.regexps={},this.hashSeed=0,this.options={},this.options=Object.assign({},t,e);var s=this.options.breakpointKey+"_"+this.options.breakpointSelector;if(s in r)return console.error("instance "+s+" already exists, using existing instance and calling refresh()..."),this.options.ignoreDOM||r[s].refresh(),r[s];r[s]=this,this.breakpoints=new i(this.options),this.hashSeed=Number((String(Math.random()).match(/\d{1,9}$/)||[1234]).shift()),this.regexps={featureMatcher:/^([\d\w-_\.]+)\(?(.*?)\)?$/i,orientation:/^landscape|portrait$/,mediaTypes:/screen|all|print|speech/},this.options.ignoreDOM||(this.refresh(),this.deployStyleSheet())}return e.prototype.refresh=function(){for(var e=this.options.breakpointSelector,t=this.options.breakpointKey,s="html"===this.options.breakpointSelector&&"default"===this.options.breakpointKey?"[data-rsa-style]:not([data-rsa-is-processed],[data-rsa-selector],[data-rsa-key]),[data-rsa-selector=html]:not([data-rsa-is-processed],[data-rsa-key]),[data-rsa-key=default]:not([data-rsa-is-processed],[data-rsa-selector])":'[data-rsa-key="'+t+'"][data-rsa-selector="'+e+'"]:not([data-rsa-is-processed]),[data-rsa-key="'+t+'"]:not([data-rsa-selector],[data-rsa-is-processed]),[data-rsa-selector="'+e+'"]:not([data-rsa-key],[data-rsa-is-processed])',i=document.querySelectorAll(s),r=0;r<i.length;r++)this.add(i[r]);return i},e.prototype.add=function(e){var t=e.dataset.rsaStyle||"",i={},r=[];e.dataset.rsaIsProcessed="true";try{i=JSON.parse(t)}catch(e){return s('JSON.parse failed on: "'+t+'"'),!1}for(var n in i){var a=this.keyToMediaQuery(n);if(a){var p=this.reOrderStyles(i[n]),h=o(a+":"+p,this.hashSeed),d=this.options.selectorTemplate(h);r.push({key:n,mediaQuery:a,originalStyle:i[n],style:p,hash:h,selector:d}),this.addStyle(a,d,p),this.options.selectorPropertyAttacher(e,h)}else s('unrecognized mediaquery key "'+n+'"',"warn")}return r},e.prototype.addStyle=function(e,t,s){return e in this.styles||(this.styles[e]={}),t in this.styles[e]||(this.styles[e][t]=s),!0},e.prototype.deployStyleSheet=function(){var e,t=this,s="rsa-stylesheet-"+this.hashSeed,i="string"==typeof t.options.attachStyleNodeTo?document.querySelector(t.options.attachStyleNodeTo):t.options.attachStyleNodeTo instanceof HTMLElement?t.options.attachStyleNodeTo:document.head,r=i.querySelector("#"+s)||((e=document.createElement("style")).setAttribute("id",s),e.setAttribute("type","text/css"),t.options.scopedStyleNode&&e.setAttribute("scoped",""),i.appendChild(e),e),o=[];for(var n in this.styles){for(var a in o.push(n+"{"),this.styles[n])o.push("\t"+a+"{ "+this.styles[n][a]+" }");o.push("}")}r.innerHTML=o.join("\n")},e.prototype.reOrderStyles=function(e){return e.split(";").filter((function(e){return""!==e.trim()})).map((function(e){return e=e.trim().split(":").map((function(e){return e.trim()})).join(":")})).sort().join(";")},e.prototype.keyToMediaQuery=function(e){if(e in this.mediaQueries)return this.mediaQueries[e];for(var t=e.split("@,@"),s=[],i=0;i<t.length;i++){var r=t[i].split("@").filter((function(e){return""!==e.trim()})),o={},n=[];this.options.alwaysPrependMediatype&&(o.media="all");for(var a=0;a<r.length;a++){var p=r[a].trim();if(0===a&&this.regexps.mediaTypes.test(p))o.media=p;else if(this.regexps.orientation.test(p))o.orientation=p;else if(this.breakpoints.test(p))this.breakpoints.processKey(o,p);else{var h=this.regexps.featureMatcher.exec(p);h&&h[1]&&h[1]in this.options.features&&this.options.features[h[1]](o,h[2])}}n.push("@media "+o.media),delete o.media;for(var d=0,l=Object.entries(o);d<l.length;d++){var u=l[d],c=u[0],y=u[1];!0===y?n.push("("+c+")"):!1!==y&&n.push("("+c+": "+y+")")}s.push(n.join(" and "))}return this.mediaQueries[e]=s.join(","),this.mediaQueries[e]},e}();e.Css=n,e.get=function(e){return e?r[e]||null:r},e.init=function(e){void 0===e&&(e={});var s=document.querySelectorAll("[data-rsa-key]:not([data-rsa-is-processed]), [data-rsa-selector]:not([data-rsa-is-processed])"),i=t.breakpointKey+"_"+t.breakpointSelector;i in r||(r[i]=new n(e));for(var o=0;o<s.length;o++){var a=s[o].dataset,p=a.rsaKey||t.breakpointKey,h=a.rsaSelector||t.breakpointSelector;r.hasOwnProperty(p+"_"+h)||new n({breakpointSelector:h,breakpointKey:p})}},e.refresh=function(){for(var e in r)r[e].refresh()},Object.defineProperty(e,"__esModule",{value:!0})}));